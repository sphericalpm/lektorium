lektorium-deploy:
  variables:
    LC_ALL: C.UTF-8
    LANG: C.UTF-8
    GIT_STRATEGY: clone
    GIT_DEPTH: 0
  script:
    - apk add --update python3 python3-dev libffi-dev openssl-dev build-base git bash docker-cli
    - git tag && git status && git describe
    - python3 -m pip install -e .[dev,inv]
    - cp ${LEKTORIUM_DEPLOY_CONFIG} invoke.yaml
    - inv deploy
  only:
    - master
